---
title: 'NextJS의 페이지 생성 방식'
date: '2024-01-05'
tags: ['web', 'nextjs']
draft: false
summary: 'NextJS page router와 app router가 어떻게 페이지를 생성하는지 알아보자.'
---

## NextJS Page Router의 페이지 생성 방식.

- page router 방식에서는 CSR, SSR, SSG과 SSG을 응용한 ISR 방식 총 네 가지 페이지 생성 방식을 제공한다.

### 1. CSR (Client Side Rendering)

- page/index.tsx에서 별도 내장 함수 선언(getStaticProps, getServerSideProps) 없이 pageMethod 내부에서 api 요청을 하는 경우 CSR로 동작.

  - example 1. useEffect를 이용한 api 호출.

    ```typescript
    // pages/index.tsx
    import React, { useState, useEffect } from 'react'

    export function Page() {
        const [data, setData] = useState(null)

        useEffect(() => {
            const fetchData = async () => {
                const response = await fetch('https://api.example.com/data')
                const result = await response.json()
                setData(result)
            }
        }, [])

        return <p>{data ? `Your data: ${data}` : 'Loading...'}</p>
    }
    ```

  - example 2. swr or react-query 등 라이브러리를 사용한 api 호출.

    ```typescript
    // pages/index.tsx
    import useSWR from 'swr'

    export function Page() {
        const { data, error, isLoading } = useSWR(
            'https://api.example.com/data',
            fetcher
        )

        if (error) return <p>Failed to load.</p>
        if (isLoading) return <p>Loading...</p>

        return <p>Your Data: {data}</p>
    }
    ```

### 2. SSR (Server Side Rendering)

- page/index.tsx에서 별도 내장 함수 선언(getServerSideProps)를 사용하여 SSR로 동작하도록 설정.

  ```typescript
  export default function Page({ data }) {
    // Render data...
  }

  export async function getServerSideProps() {
    const res = await fetch(`https://.../data`);
    const data = await res.json();

    return { props: { data } };
  }
  ```

### 3. SSG (Static Site Generation)

- page/index.tsx에서 api 요청이 없거나, 별도 내장 함수 선언(getStaticProps)를 사용하여 SSG로 동작하도록 설정.

  ```typescript
  export default function Blog({ posts }) {
    // Render posts...
  }

  export async function getStaticProps() {
    // 빌드 시점에 `posts`를 받아온다.
    const res = await fetch('https://.../posts');
    const posts = await res.json();

    return {
      props: {
        posts,
      },
    };
  }
  ```

### 4. ISR (Incremental Static Regeneration)

- page/index.tsx에서 api 요청이 없거나, 별도 내장 함수 선언(getStaticProps)를 응용하여 지정한 data revalidate 시간마다 정적 페이지를 재생성 할 수 있음.

  ```typescript
  export default function Blog({ posts }) {
    // Render posts...
  }

  export async function getStaticProps() {
    // 빌드 시점에 `posts`를 받아온다.
    const res = await fetch('https://.../posts');
    const posts = await res.json();

    return {
      props: {
        posts,
      },
      revalidate: 10, // 초 단위
    };
  }
  ```

## NextJS App Router의 페이지 생성 방식.

- app router는 페이지 생성 방식이 별도로 존재하지 않으며, fetch의 설정을 통해 자동으로 페이지를 생성.(route segment config를 통해 지정 할 수도 있다.)
- app router에서 CSR은 페이지 단위가 아닌 컴포넌트 단위로 사용하는 것으로 개념이 바뀜.

  ```typescript
  export default async function Page() {
  // `getStaticProps`와 유사한 동작으로 SSG로 설정.(기본값)
  const staticData = await fetch(`https://...`, { cache: 'force-cache' })

  // `getServerSideProps`와 유사한 동작으로 SSR로 설정.
  const dynamicData = await fetch(`https://...`, { cache: 'no-store' })

  // `getStaticProps`를 응용하여 `revalidate`속성으로 ISR로 설정.
  const revalidatedData = await fetch(`https://...`, {
      next: { revalidate: 10 },
  })

  return <div>...</div>
  }
  ```

- [route segment config](https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config) 설정으로 페이지 생성 방식을 강제 할 수 있음.

  ```typescript
  // page.tsx | route.ts
  export const dynamic = 'auto';
  export const dynamicParams = true;
  export const revalidate = false;
  export const fetchCache = 'auto';
  export const runtime = 'nodejs';
  export const preferredRegion = 'auto';
  export const maxDuration = 5;

  export default function MyComponent() {}
  ```

## ref

- docs
  - [nextjs page router](https://nextjs.org/docs/pages/building-your-application/rendering/client-side-rendering)
  - [nextjs app router](https://nextjs.org/docs/app/building-your-application/rendering/server-components)
  - [nextjs app router migrating](https://nextjs.org/docs/app/building-your-application/upgrading/app-router-migration#step-6-migrating-data-fetching-methods)
  - [nextjs app router route segment config](https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config)
